---
import Heading from '@atoms/Heading.astro';
import Text from '@atoms/Text.astro';
import InputField from '@atoms/InputField.astro';
import TextareaField from '@atoms/TextareaField.astro';
import JoinTabButton from '@atoms/JoinTabButton.astro';
import { cn } from "@lib/utils/cn";
---
<section id="unete" class="py-20 bg-gray-50">
    <div class="max-w-3xl mx-auto text-center mb-12">
        <Heading level={2}>Únete a SkillUp</Heading>
        <Text>Transforma el futuro de la educación en Guatemala. Cada actor es clave para el éxito.</Text>
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 delay-200">
        <div data-tab-container role="tablist" class="flex space-x-2 mb-6 border-b">
            <JoinTabButton type="docente" text="Docente/Escuela"/>
            <JoinTabButton type="estudiante" text="Estudiante/Mentor"/>
            <JoinTabButton type="inversionista" text="Inversionista Social"/>
        </div>

        <form data-panel-container id="join-form" class="space-y-6">
            <div data-panel="docente" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <InputField label="Nombre completo" name="docente_name" placeholder="Tu nombre"/>
                <InputField label="Correo electrónico" name="docente_email" type="email" placeholder="tu@email.com"/>
                <InputField label="Teléfono/WhatsApp" name="docente_phone" placeholder="+502 1234 5678"/>
                <InputField label="Institución educativa" name="docente_school" placeholder="Nombre de tu escuela"/>
                <div class="sm:col-span-2">
                    <TextareaField
                            label="Mensaje"
                            name="docente_message"
                            placeholder="Cuéntanos sobre tu institución, número de estudiantes, y cómo te gustaría implementar SkillUp..."
                    />
                </div>
            </div>

            <div data-panel="estudiante" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                <InputField label="Nombre completo" name="est_name" placeholder="Tu nombre"/>
                <InputField label="Correo electrónico" name="est_email" type="email" placeholder="tu@email.com"/>
                <InputField label="Teléfono/WhatsApp" name="est_phone" placeholder="+502 1234 5678"/>
                <InputField label="Institución educativa" name="est_school" placeholder="Nombre de tu colegio"/>
                <div class="sm:col-span-2">
                    <TextareaField
                            label="Mensaje"
                            name="est_message"
                            placeholder="Cuéntanos sobre ti, tu rol como mentor y la experiencia que aportas..."
                    />
                </div>
            </div>

            <div data-panel="inversionista" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                <InputField label="Nombre completo" name="inv_name" placeholder="Tu nombre"/>
                <InputField label="Correo electrónico" name="inv_email" type="email" placeholder="tu@email.com"/>
                <InputField label="Teléfono/WhatsApp" name="inv_phone" placeholder="+502 1234 5678"/>
                <InputField label="Organización" name="inv_org" placeholder="Nombre de tu fundación"/>
                <div class="sm:col-span-2">
                    <TextareaField
                            label="Mensaje"
                            name="inv_message"
                            placeholder="Indica el tipo de apoyo que te interesa ofrecer y tu visión de alianza..."
                    />
                </div>
            </div>

            <div class="sm:col-span-2">
                <button
                        type="submit"
                        class={cn(
                          "w-full bg-teal-500 text-white px-6 py-3 rounded-lg font-medium transition transform hover:scale-105",
                          "hover:bg-teal-600",
                        )}
                >
                    Solicitar piloto gratuito
                </button>
            </div>
        </form>
    </div>

    <script type="module">
      class TabManager {
        constructor() {
          this.tabContainer = document.querySelector('[data-tab-container]');
          this.panelContainer = document.querySelector('[data-panel-container]');
          this.init();
        }

        init() {
          this.tabContainer.addEventListener('click', (e) => {
            const tab = e.target.closest('[data-tab]');
            if (!tab) return;
            this._toggle(tab);
          })
          const defaultTab = this.tabContainer.querySelector('[data-tab="docente"]');
          console.log(defaultTab);
          if (defaultTab) {
            this._toggle(defaultTab);
          }
        }

        _toggle(tab) {
          const tabs = this.tabContainer.querySelectorAll('[data-tab]');
          const panels = this.panelContainer.querySelectorAll('[data-panel]');

          const target = tab.getAttribute('data-tab');
          tabs.forEach(t => t.classList.remove('bg-teal-500', 'text-white'));
          tabs.forEach(t => t.classList.add('text-gray-700'));
          panels.forEach(p => p.classList.add('hidden'));
          tab.classList.add('bg-teal-500', 'text-white');
          tab.classList.remove('text-gray-700');
          tabs.forEach(p => delete p.dataset.active);
          document.querySelector(`[data-panel="${target}"]`)?.classList.remove('hidden');
          tab.dataset.active = 'true';
        }
      }

      new TabManager()
    </script>
</section>
